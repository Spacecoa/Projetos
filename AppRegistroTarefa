import sys
import time
from PyQt5.QtWidgets import QApplication, QMainWindow, QLabel, QWidget, QVBoxLayout, QHBoxLayout, \
    QLineEdit, QPushButton, QListWidget, QMessageBox, QCheckBox
from PyQt5.QtCore import QTimer, QRect, Qt, QPropertyAnimation, pyqtProperty, pyqtSignal
from PyQt5.QtWidgets import QListWidgetItem


class ConfirmationBox(QLabel):
    animationFinished = pyqtSignal()

    def __init__(self, parent=None):
        super().__init__(parent)
        self.setGeometry(0, 0, 0, 0)
        self.setAlignment(Qt.AlignCenter)
        self.setStyleSheet("background-color: #000000;")
        self.animation = QPropertyAnimation(self, b"geometry")
        self.animation.setStartValue(QRect(0, 0, 0, 0))
        self.animation.setEndValue(QRect(100, 100, 200, 100))
        self.animation.finished.connect(self.animationFinished.emit)

    def startAnimation(self):
        self.animation.start()

    def resetAnimation(self):
        self.setGeometry(0, 0, 0, 0)

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Aplicativo de Tarefas")
        self.central_widget = QWidget()
        self.setCentralWidget(self.central_widget)
        self.layout = QVBoxLayout()
        self.central_widget.setLayout(self.layout)
        self.minhas_tarefas = []  # Lista de tarefas
        self.tarefas_realizadas = []  # Lista de tarefas realizadas
        self.create_task_widgets()
        self.create_task_list_widgets()
        self.create_completed_tasks_list_widgets()
        self.confirmation_box = ConfirmationBox()
        self.layout.addWidget(self.confirmation_box)  

    def adicionar_tarefa(self):
        tarefa = self.entry_tarefa.text()
        data = self.entry_data.text()
        hora = self.entry_hora.text()
        if tarefa != "" and data != "" and hora != "":
            tarefa_com_data_hora = f"{tarefa} (Data: {data}, Hora: {hora})"
            self.minhas_tarefas.append(tarefa_com_data_hora)
            self.create_task_with_checkbox(tarefa_com_data_hora)
            self.entry_tarefa.clear()
            self.entry_data.clear()
            self.entry_hora.clear()
        else:
            self.show_warning("Campos Vazios", "Por favor, preencha todos os campos.")

    def deletar_tarefa(self):
        index = self.listbox_tarefas.currentRow()
        if index >= 0:
            tarefa_deletada = self.listbox_tarefas.item(index).text()
            self.minhas_tarefas.remove(tarefa_deletada)
            self.listbox_tarefas.takeItem(index)

    def tarefa_realizada(self):
        index = self.listbox_tarefas.currentRow()
        if index >= 0:
            item = self.listbox_tarefas.item(index)
            checkbox = self.listbox_tarefas.itemWidget(item)
            tarefa_realizada = checkbox.text()
            self.minhas_tarefas.remove(tarefa_realizada)
            self.tarefas_realizadas.append(tarefa_realizada)
            self.listbox_tarefas.takeItem(index)
            self.create_completed_task_checkbox(tarefa_realizada)

    def verificar_tarefas(self):
        agora = time.strftime("%Y-%m-%d %H:%M")
        for tarefa in self.minhas_tarefas:
            data_hora_tarefa = tarefa.split("(Data: ")[1].split(", Hora: ")[0]
            hora_tarefa = tarefa.split("Hora: ")[1][:-1]
            data_hora_tarefa_completa = f"{data_hora_tarefa} {hora_tarefa}"
            if data_hora_tarefa_completa == agora:
                QMessageBox.information(self, "Tarefa", f"É hora de fazer a seguinte tarefa:\n\n{tarefa}")

    def show_warning(self, title, message):
        QMessageBox.warning(self, title, message)

    def show_info(self, title, message):
        QMessageBox.information(self, title, message)

    def create_task_widgets(self):
        frame_adicionar = QWidget()
        layout_adicionar = QVBoxLayout(frame_adicionar)

        label_tarefa = QLabel("Tarefa:")
        self.entry_tarefa = QLineEdit()
        label_data = QLabel("Data:")
        self.entry_data = QLineEdit()
        label_hora = QLabel("Hora:")
        self.entry_hora = QLineEdit()
        button_adicionar = QPushButton("Adicionar")
        button_adicionar.clicked.connect(self.adicionar_tarefa)

        layout_adicionar.addWidget(label_tarefa)
        layout_adicionar.addWidget(self.entry_tarefa)
        layout_adicionar.addWidget(label_data)
        layout_adicionar.addWidget(self.entry_data)
        layout_adicionar.addWidget(label_hora)
        layout_adicionar.addWidget(self.entry_hora)
        layout_adicionar.addWidget(button_adicionar)

        self.layout.addWidget(frame_adicionar)

    def create_task_list_widgets(self):
        frame_tarefas = QWidget()
        layout_tarefas = QVBoxLayout(frame_tarefas)

        label_tarefas = QLabel("Minhas Tarefas:")
        self.listbox_tarefas = QListWidget()
        button_deletar = QPushButton("Deletar")
        button_deletar.clicked.connect(self.deletar_tarefa)
        button_realizada = QPushButton("Tarefa Realizada")
        button_realizada.clicked.connect(self.tarefa_realizada)

        layout_tarefas.addWidget(label_tarefas)
        layout_tarefas.addWidget(self.listbox_tarefas)

        layout_button = QHBoxLayout()
        layout_button.addWidget(button_deletar)
        layout_button.addWidget(button_realizada)

        layout_tarefas.addLayout(layout_button)

        self.layout.addWidget(frame_tarefas)

    def create_completed_tasks_list_widgets(self):
        frame_tarefas_realizadas = QWidget()
        layout_tarefas_realizadas = QVBoxLayout(frame_tarefas_realizadas)

        label_tarefas_realizadas = QLabel("Tarefas Realizadas:")
        self.listbox_tarefas_realizadas = QListWidget()

        layout_tarefas_realizadas.addWidget(label_tarefas_realizadas)
        layout_tarefas_realizadas.addWidget(self.listbox_tarefas_realizadas)

        self.layout.addWidget(frame_tarefas_realizadas)

    def create_completed_task_checkbox(self, tarefa):
        checkbox = QCheckBox(tarefa)
        checkbox.setStyleSheet("QCheckBox { font-size: 14px; }")
        self.listbox_tarefas_realizadas.addItem(checkbox.text())

    def create_task_with_checkbox(self, tarefa):
        checkbox = QCheckBox(tarefa)
        checkbox.setStyleSheet("QCheckBox { font-size: 14px; }")
        item = QListWidgetItem(self.listbox_tarefas)
        item.setSizeHint(checkbox.sizeHint())
        self.listbox_tarefas.setItemWidget(item, checkbox)

def verify_tasks(self):
        self.verificar_tarefas()
        QTimer.singleShot(1000 * 60, self.verify_tasks)  # Verificar tarefas periodicamente

if __name__ == "__main__":
    app = QApplication(sys.argv)

    main_window = MainWindow()
    main_window.show()

    QTimer.singleShot(0, main_window.verificar_tarefas)  # Iniciar a verificação de tarefas

    app.exec_()
